<!-- {% load static %} -->
<!DOCTYPE html>
<html lang="ko" class="h-100">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors" />
    <meta name="generator" content="Hugo 0.104.2" />
    <title>STADY</title>
    <!-- css 파일 -->
    <link href="/static/css/bootstrap.min.css?after" rel="stylesheet" />
    <link href="/static/css/base.css?after" rel="stylesheet" />
    <!-- bootstrap css cdn -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" />

    <!-- JS 파일 -->
    <script src="/static/js/bootstrap.bundle.min.js?after"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.js"
        integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script> -->
    <style>
        .stady_btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .stady_wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .cam_size {
            width: 375px;
            height: 375px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;

            background-color: #e9ecef;
            margin-bottom: 10px;
        }

        .nav_logo {
            width: 100px;
            height: 40px;
        }

        #my-header {}

        #main_nav {
            padding-top: 1rem;
            padding-bottom: 1rem;
            background-color: #fff;
            max-width: 1100px;
            margin: 0 auto;
        }
    </style>
</head>

<body class="d-flex h-100 text-center" style="background-color: #00b395;">
    <div class="w-100 h-100 p-3 mx-auto">
        <header class="mb-auto" style="background-color: white; max-width: 720px; margin: 0 auto;">
            <div class="contain">
                <div class="fixed-top" id="main_nav">
                    <h3 class="float-md-start mb-0">
                        <a href="/">
                            <img class="nav_logo" src="/static/images/stady_1.png" />
                        </a>
                    </h3>
                    <nav class="nav nav-masthead justify-content-center float-md-end">
                        <a class="nav-link fw-bold py-1 px-0" aria-current="true" href="/">Home</a>
                        <a class="nav-link fw-bold py-1 px-0" aria-current="true" href="">Community</a>
                        <a class="nav-link fw-bold py-1 px-0" aria-current="true"
                            href="/study_group/study_index.html">스터디
                            모임</a>
                        <div style="margin-left: 20px; margin-right: 10px">
                            <div class="post_header_more_btn_box">
                                <div class="btn-group">
                                    <img type="button" class="img_circle dropdown-toggle" width="30px" height="30px"
                                        src="/static/images/stady_bear_face.png" data-bs-toggle="dropdown"
                                        aria-expanded="false" />
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'profile:profile' %}">프로필</a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="/user/update.html">회원정보수정</a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="javascript:handleLogout();">로그아웃</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>

        </header>

        <main class="container" style="height: 500px; margin-top : 100px;">
            <button type="button" onclick="createPost()">스터디 모집하기</button>
            <div class="col-10">
                <div class="input-group">
                    <input type="text" id="search_kw" class="form-control" value="{{ kw|default_if_none:'' }}">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="btn_search">찾기</button>
                    </div>
                </div>
            </div>
        </div>
            <div class="row text-center" id="study_view" style="width: 100%;"></div>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

            <!-- Modal -->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="1"
                aria-labelledby="staticBackdropLabel" aria-hidden="true" style="">
                <div class="modal-dialog modal-xl" style="border-radius: 10px; overflow: hidden;">
                    <div class="modal-content">
                        <div class="modal-body" style="padding: 0;">
                            <div id="modal-head" class="p-3" style="height: 300px; ">

                                <div class="align-bottom" style="align-self: end;">
                                    <b>
                                        <h3 id="study-title" class="text-start" style="color: white;"></h3>
                                    </b>
                                    <button id="status" type="button" class="btn btn-primary"
                                        onclick="submit()">Understood</button>
                                    <button>star</button>
                                    <span id="study-retio" class="p-1"
                                        style="color: white; border: 1px solid white; border-radius: 20%;">몇명있는지 보여줄
                                        예정,,,</span>
                                    <!-- <span style="color: white;">태그들 있을 예정</span> -->
                                </div>
                                <i class="fas fa-times text-end" data-bs-dismiss="modal" aria-label="Close"
                                    style="margin-left: auto; cursor: pointer; color: rgb(255, 255, 255); font-size: 30px;"></i>
                            </div>
                        </div>
                        <div class="modal-footer" style="display: block; text-align: left;">
                            <h6 id="author" class="text-secondary"></h6>

                            <div id="content"></div>
                        </div>
                    </div>
                </div>
            </div>

            <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
            <script language="javascript">
                backend_base_url = "http://127.0.0.1:8000/"
                function viewStudy(study_id) {
                    const modal = document.getElementById('staticBackdrop');
                    let tumbnailImg = document.getElementById('tumbnail-img');

                    $.ajax({
                        type: "GET",
                        data: {},
                        url: `http://127.0.0.1:8000/studies/${study_id}/`,
                        headers: {
                            "Authorization": "Bearer " + localStorage.getItem("access"),
                        },
                        success: function (result) {
                            console.log('성공:', result, result['thumbnail_img']);
                            // $('#thumbnail-img').attr('src', result['thumbnail_img']);
                            $('#modal-head').attr('style', `background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.2)), url(${backend_base_url}${result['thumbnail_img']});
                                                        background-position: center;
                                                        background-size: cover;
                                                        height : 300px;
                                                        display: flex;
                            `)
                            $('#study-title').text(result['title'])
                            $('#author').text(result['user'])
                            $('#content').text(result['content'])
                            $('#status').attr('name', `${study_id}`)
                            $('#status').attr('onclick', `submit(${study_id})`)

                            let isStudent = result['is_student']
                            let isAuthor = result['is_author']
                            let sended = result['sended']
                            let onOffLine = result['is_online']
                            let isLike = result['is_like']
                            let headCount = result['headcount']
                            let nowCnt = result['now_cnt']

                            $('#study-retio').text(`${nowCnt}/${headCount}`)

                            if (isStudent) {
                                $('#status').text('참여중')
                            } else if (isAuthor) {
                                $('#status').text('관리자')
                            } else if (sended) {
                                $('#status').text('대기중')
                            } else {
                                $('#status').text('신청하기')
                            }
                        },
                    });
                    $('#staticBackdrop').modal('show')
                }

                function submit(study_id) {

                    $.ajax({
                        type: "POST",
                        data: {},
                        url: `http://127.0.0.1:8000/studies/${study_id}/`,
                        headers: {
                            "Authorization": "Bearer " + localStorage.getItem("access"),
                        },
                        success: function (result) {
                            let isStudent = result['is_student']
                            let isAuthor = result['is_author']
                            let sended = result['sended']
                            if (isAuthor == false) {

                            }

                            $('#status').text("참여중")
                        },
                    });

                }

            </script>

            <script src="/static/js/api.js"></script>
            <script src="/static/js/user.js"></script>
            
        </main>
    </div>

    <script>
        window.onload = loadStudyView();
    </script>
</body>

</html>